# 网络层

## 1、概述

网络层负责在不同网络之间转发数据，尽力正确的传递数据到目的地，不负责顺序和丢包处理。

数据链路层负责尽力无差错接收，进行容错检验。

传输层负责可靠传输。

物理层负责屏蔽硬件差异，实现不同网络介质之间能进行网络传输。



**各层的数据包格式和网络设备**

| 层         | 传输单位 | 数据格式               | 网络设备 | 最大传输字节 |
| ---------- | -------- | ---------------------- | -------- | ------------ |
| 物理层     | Bit      | 二进制01               | 集线器   |              |
| 数据链路层 | 帧       | Mac地址 数据包 FCS     | 交换机   | 46-1500      |
| 网络层     | 包       | 网络层首部 数据 IP地址 | 路由器   | 65535        |
| 传输层     | 段       | 数据                   |          |              |

**上一层设备能看懂下一层的信息；对于网络层的数据，数据链路层会将其分片进行传输；**





### 1、网络层数据包格式

![网络层数据包格式](/Users/cg/Desktop/Information/1、基础/计算机网络/images/网络层数据包格式.png)



版本：标示TCP/IP协议的版本，IPv4还是IPv6

区分服务：标示服务的优先级，Qos

总长度：计算可选部分的长度

标识：标识分片后的数据包，使接收方能够组装分片后的数据包

标记：表示该数据包是分片数据包还是完整的数据包

片偏移：该片在完整数据包中的偏移

生存时间：TTL，防止路由环路

协议：标识数据包是什么协议的数据包（ICMP或者TCP。。。）

首部检验和：传输过程中，由于TTL会发生变化，使用首部检验和检验网络层首部是否发生了错误





## 2、网络传输

### 1、本网段传输

本网段进行传输，网络层先通过子网掩码判断目的地址是否是本网段的，如果是，会广播一个ARP包，收集本网段的机器的Mac地址，然后在网络层数据帧中添加目标机器的Mac地址，进行网络传输。



### 2、跨网段

先通过自身的子网掩码与目标IP进行与运算，判断是否是同一个网段，如果不是，则将目标Mac地址设为网关地址（路由器），由网关进行跨网段数据传输，网关在进行跨网段数据传输时，会将源Mac地址设置为自己的Mac地址，目标Mac地址设置为目标网段的网关进行传输。



## 3、ARP协议

arp协议是网络层协议，为IP协议（网络层协议）提供服务

通过将IP地址通过广播 目标Mac地址是FF-FF-FF-FF-FF-FF，解析目标IP地址的Mac地址



## 4、ICMP协议

主要使用ping命令



### 1、ping命令应用

#### 1、猜测服务器操作系统

通过查看ping命令返回的TTL（数据包生存时间，由目标地址发出，各操作系统不一样，每经过一个路由器，TTL-1）

Linux：64

Windows：128

Unix：255



#### 2、沿途经过多少路由器

~~~shell
ping www.baidu.com -t 2
pathping 
tracert
~~~

通过指定-t后面的参数，直到能ping通为止



## 5、IGMP协议

点到点：mms：IP地址，点播视频

多播：局域网中的一组计算机可以收到

广播：局域网的所有所有计算机都可以收到

IGMP协议可以实现局域网的广播，网卡绑定广播地址后就可以收到广播的信息，该协议是用于局域网间的视频广播功能。



特点：不建立会话，点播可以拖拽进度，广播或者多播无法控制进度，只能是播到那看到那（类似直播）。



## 6、RIP协议

动态路由使用的协议，主要是网关通过广播告诉其他网关路由的路径，会进行周期性更新。



## 路由器

网络层主要设备，负责在不同网段之间进行数据的传输。

在局域网中，路由器一般使用局域网的第一个地址，例如192.168.0.1，该局域网中的其他网络设备的网关设置为路由器的局域网地址，即所有跨网段的数据传输都交给路由器进行处理。





